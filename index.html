<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Simulador de Aposentadoria e Investimentos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #f5f7fb;
      --bg-card: #ffffff;
      --primary: #1a73e8;
      --primary-soft: #e8f0fe;
      --text-main: #202124;
      --text-soft: #5f6368;
      --border-soft: #dadce0;
      --danger: #d93025;
      --radius-lg: 16px;
      --radius-md: 10px;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 24px;
      background: var(--bg);
      color: var(--text-main);
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    header {
      margin-bottom: 24px;
    }

    header h1 {
      font-size: 1.9rem;
      margin: 0;
      color: var(--text-main);
    }

    header p {
      margin: 4px 0 0;
      color: var(--text-soft);
      font-size: 0.95rem;
    }

    .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
    }

    .select {
      appearance: none;
      -webkit-appearance: none;
      padding: 8px 12px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      background: #fff;
      font-size: 0.9rem;
      color: var(--text-main);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 20px 22px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--border-soft);
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-badge {
      background: var(--primary-soft);
      color: var(--primary);
      border-radius: 999px;
      padding: 2px 10px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .card-subtitle {
      margin: 0;
      margin-bottom: 16px;
      color: var(--text-soft);
      font-size: 0.88rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 12px;
      align-items: center;
      margin-bottom: 10px;
    }

    @media (max-width: 700px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    label {
      font-size: 0.9rem;
      color: var(--text-main);
    }

    label span {
      color: var(--primary);
      font-weight: 600;
      margin-right: 6px;
    }

    label small {
      display: block;
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-top: 3px;
    }

    input[type="number"] {
      width: 100%;
      padding: 9px 10px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      font-size: 0.95rem;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease;
      background: #fff;
    }

    input[type="number"]:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.15);
    }

    .inline-suffix {
      font-size: 0.9rem;
      color: var(--text-soft);
      margin-left: 4px;
    }

    .btn {
      margin-top: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: #fff;
      font-weight: 600;
      font-size: 0.92rem;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(26, 115, 232, 0.3);
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease;
    }

    .btn:hover {
      background: #1459b5;
      box-shadow: 0 3px 8px rgba(26, 115, 232, 0.35);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(26, 115, 232, 0.3);
    }

    .btn-icon {
      font-size: 1rem;
      line-height: 1;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .result-card {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      padding: 12px 12px 10px;
      background: #f9fafc;
    }

    .result-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .result-value {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text-main);
      white-space: nowrap;
    }

    .result-note {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 3px;
    }

    .result-highlight {
      background: var(--primary-soft);
      border-color: rgba(26, 115, 232, 0.4);
    }

    .info-list {
      margin: 10px 0 0;
      padding-left: 18px;
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    .info-list li + li {
      margin-top: 4px;
    }

    .disclaimer {
      margin-top: 18px;
      padding: 10px 12px;
      border-radius: var(--radius-md);
      background: #fff8e1;
      border: 1px solid #f7d98a;
      font-size: 0.8rem;
      color: #8d6e00;
    }

    .error-msg {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--danger);
    }

    footer {
      margin-top: 22px;
      font-size: 0.8rem;
      color: var(--text-soft);
      line-height: 1.4;
    }

    .chart-container {
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--border-soft);
    }

    .chart-wrapper {
      position: relative;
      height: 400px;
      margin-top: 16px;
    }

    @media (max-width: 700px) {
      .chart-wrapper {
        height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 id="title">Simulador de Aposentadoria e Investimentos</h1>
      <p id="subtitle">
        Ajuste os valores abaixo e veja como o tempo, os aportes mensais e os juros compostos
        podem influenciar o seu patrimônio futuro.
      </p>
      <div class="header-actions">
        <label for="lang" class="visually-hidden">Idioma</label>
        <select id="lang" class="select" aria-label="Idioma">
          <option value="pt-BR">Português (Brasil)</option>
          <option value="en-US">English (US)</option>
        </select>
        <label for="currency" class="visually-hidden">Moeda</label>
        <select id="currency" class="select" aria-label="Moeda">
          <option value="BRL">R$ BRL</option>
          <option value="USD">$ USD</option>
        </select>
      </div>
    </header>

    <div class="grid">
      <!-- COLUNA ESQUERDA: FORMULÁRIO -->
      <section class="card">
        <div class="card-title">
          <span class="card-title-badge">Entrada de dados</span>
        </div>
        <p class="card-subtitle" id="formSubtitle">
          Preencha as informações do seu plano de investimento. As taxas anuais devem ser digitadas em
          <strong>percentual ao ano</strong> (por exemplo, 16.5 para 16,5% a.a.).
        </p>

        <div class="form-row">
          <label for="prazo">
            <span>1.</span> Prazo de investimento (anos)
            <small>Quanto tempo você pretende manter o dinheiro investido.</small>
          </label>
          <div>
            <input id="prazo" type="number" min="1" step="1" value="20" />
            <span class="inline-suffix" id="suffixPrazo">anos</span>
          </div>
        </div>

        <div class="form-row">
          <label for="valorInicial">
            <span>2.</span> Valor inicial
            <small>Patrimônio já investido hoje.</small>
          </label>
          <div>
            <input id="valorInicial" type="number" min="0" step="1000" value="25000" />
            <span class="inline-suffix" id="suffixValor">R$</span>
          </div>
        </div>

        <div class="form-row">
          <label for="aporteMensal">
            <span>3.</span> Aporte mensal
            <small>Quanto você pretende investir todo mês.</small>
          </label>
          <div>
            <input id="aporteMensal" type="number" min="0" step="100" value="2000" />
            <span class="inline-suffix" id="suffixAporte">R$ / mês</span>
          </div>
        </div>

        <div class="form-row">
          <label for="taxaAnual">
            <span>4.</span> Rentabilidade anual
            <small>Taxa média estimada do investimento (bruta, a.a.).</small>
          </label>
          <div>
            <input id="taxaAnual" type="number" min="0" step="0.1" value="16.5" />
            <span class="inline-suffix" id="suffixTaxa">% a.a.</span>
          </div>
        </div>

        <div class="form-row">
          <label for="correcaoAporte">
            <span>5.</span> Correção anual dos aportes
            <small>
              Percentual de aumento anual do valor do aporte mensal
              (ex.: para repor inflação ou aumento de renda).
            </small>
          </label>
          <div>
            <input id="correcaoAporte" type="number" min="0" step="0.1" value="5" />
            <span class="inline-suffix" id="suffixCorrecao">% a.a.</span>
          </div>
        </div>

        <div class="form-row">
          <label for="inflacao">
            <span>6.</span> <span id="labelInflacao">Inflação média anual estimada</span>
            <small id="helpInflacao">Média histórica dos últimos 10 anos: Brasil ~6.5%, EUA ~3.5%. Use para calcular poder de compra futuro.</small>
          </label>
          <div>
            <input id="inflacao" type="number" min="0" step="0.1" value="6.5" />
            <span class="inline-suffix" id="suffixInflacao">% a.a.</span>
          </div>
        </div>

        <button id="btnSimular" class="btn">
          <span class="btn-icon">▶</span>
          Rodar simulação
        </button>

        <div id="error" class="error-msg" style="display:none;"></div>
      </section>

      <!-- COLUNA DIREITA: RESULTADOS -->
      <section class="card">
        <div class="card-title">
          <span class="card-title-badge">Resultados</span>
        </div>
        <p class="card-subtitle">
          Os valores abaixo são estimativas, assumindo aportes mensais constantes ao longo do período,
          com correção anual e juros compostos mensais.
        </p>

        <div class="results-grid">
          <div class="result-card">
            <div class="result-label">Total investido</div>
            <div id="outTotalInvestido" class="result-value">R$ 0,00</div>
            <div class="result-note">
              Soma de todos os aportes realizados, incluindo o valor inicial.
            </div>
          </div>

          <div class="result-card result-highlight">
            <div class="result-label">Patrimônio final</div>
            <div id="outPatrimonioFinal" class="result-value">R$ 0,00</div>
            <div class="result-note">
              Valor estimado ao final do período, considerando juros compostos.
            </div>
          </div>

          <div class="result-card">
            <div class="result-label">Renda mensal estimada</div>
            <div id="outRendaMensal" class="result-value">R$ 0,00</div>
            <div class="result-note">
              Aproximação de renda mensal usando a mesma taxa mensal do investimento.
            </div>
          </div>

          <div class="result-card result-highlight">
            <div class="result-label">Renda ajustada (hoje)</div>
            <div id="outRendaAjustada" class="result-value">R$ 0,00</div>
            <div class="result-note">
              Poder de compra equivalente da renda mensal em valores de hoje, considerando inflação.
            </div>
          </div>

          <div class="result-card">
            <div class="result-label">Último aporte mensal</div>
            <div id="outUltimoAporte" class="result-value">R$ 0,00</div>
            <div class="result-note">
              Valor aproximado do aporte mensal no último ano da simulação.
            </div>
          </div>
        </div>

        <ul class="info-list">
          <li>Se não houver valor inicial, deixe o campo 2 com R$ 0,00.</li>
          <li>Se não quiser fazer aportes mensais, deixe o campo 3 com R$ 0,00.</li>
          <li>
            As taxas usadas são apenas exemplos. Adapte conforme o tipo de investimento e seu perfil de risco.
          </li>
        </ul>

        <div class="disclaimer">
          Este simulador é apenas uma ferramenta educacional e não constitui recomendação de investimento.
          Considere custos, impostos e seu perfil antes de tomar decisões financeiras reais.
        </div>
      </section>
    </div>

    <!-- GRÁFICO DE EVOLUÇÃO -->
    <div class="chart-container">
      <div class="card-title">
        <span class="card-title-badge">Evolução do patrimônio</span>
      </div>
      <p class="card-subtitle">
        Veja como seu patrimônio evolui ao longo do tempo. A linha azul mostra o patrimônio total
        e a linha verde representa o total investido (sem juros).
      </p>
      <div class="chart-wrapper">
        <canvas id="chartPatrimonio"></canvas>
      </div>
    </div>

    <footer>
      Dica: você pode ajustar livremente as taxas e valores para testar diferentes cenários de aposentadoria
      ou de construção de patrimônio de longo prazo.
    </footer>
  </div>

  <script>
    let chartInstance = null;
    let currentLang = 'pt-BR';
    let currentCurrency = 'BRL';

    const i18n = {
      'pt-BR': {
        title: 'Simulador de Aposentadoria e Investimentos',
        subtitle: 'Ajuste os valores abaixo e veja como o tempo, os aportes mensais e os juros compostos podem influenciar o seu patrimônio futuro.',
        formBadge: 'Entrada de dados',
        formSubtitle: 'Preencha as informações do seu plano de investimento. As taxas anuais devem ser digitadas em',
        formSubtitleBold: 'percentual ao ano',
        formSubtitleEnd: '(por exemplo, 16.5 para 16,5% a.a.).',
        prazoLabel: 'Prazo de investimento (anos)',
        prazoHelp: 'Quanto tempo você pretende manter o dinheiro investido.',
        prazoSuffix: 'anos',
        valorInicialLabel: 'Valor inicial',
        valorInicialHelp: 'Patrimônio já investido hoje.',
        valorInicialSuffix: 'R$',
        aporteMensalLabel: 'Aporte mensal',
        aporteMensalHelp: 'Quanto você pretende investir todo mês.',
        aporteMensalSuffix: 'R$ / mês',
        taxaAnualLabel: 'Rentabilidade anual',
        taxaAnualHelp: 'Taxa média estimada do investimento (bruta, a.a.).',
        taxaSuffix: '% a.a.',
        correcaoLabel: 'Correção anual dos aportes',
        correcaoHelp: 'Percentual de aumento anual do valor do aporte mensal (ex.: para repor inflação ou aumento de renda).',
        inflacaoLabel: 'Inflação média anual estimada',
        inflacaoHelp: 'Média histórica dos últimos 10 anos: Brasil ~6.5%, EUA ~3.5%. Use para calcular poder de compra futuro.',
        runSim: 'Rodar simulação',
        resultsBadge: 'Resultados',
        resultsSubtitle: 'Os valores abaixo são estimativas, assumindo aportes mensais constantes ao longo do período, com correção anual e juros compostos mensais.',
        totalInvestido: 'Total investido',
        patrimonioFinal: 'Patrimônio final',
        rendaMensal: 'Renda mensal estimada',
        rendaMensalAjustada: 'Renda ajustada (hoje)',
        ultimoAporte: 'Último aporte mensal',
        totalInvestidoNote: 'Soma de todos os aportes realizados, incluindo o valor inicial.',
        patrimonioFinalNote: 'Valor estimado ao final do período, considerando juros compostos.',
        rendaMensalNote: 'Aproximação de renda mensal usando a mesma taxa mensal do investimento.',
        rendaMensalAjustadaNote: 'Poder de compra equivalente da renda mensal em valores de hoje, considerando inflação.',
        ultimoAporteNote: 'Valor aproximado do aporte mensal no último ano da simulação.',
        hints: ['Se não houver valor inicial, deixe o campo com 0.', 'Se não quiser fazer aportes mensais, deixe o campo com 0.', 'As taxas usadas são apenas exemplos. Adapte conforme o tipo de investimento e seu perfil de risco.'],
        disclaimer: 'Este simulador é apenas uma ferramenta educacional e não constitui recomendação de investimento. Considere custos, impostos e seu perfil antes de tomar decisões financeiras reais.',
        footer: 'Dica: você pode ajustar livremente as taxas e valores para testar diferentes cenários de aposentadoria ou de construção de patrimônio de longo prazo.',
        chartBadge: 'Evolução do patrimônio',
        chartSubtitle: 'A linha azul mostra o patrimônio total, a verde o total investido e a laranja o patrimônio ajustado pela inflação (poder de compra real).',
        chartTotal: 'Patrimônio Total',
        chartInvested: 'Total Investido',
        chartInflationAdj: 'Ajustado por Inflação',
        errorPrazo: 'O prazo de investimento deve ser maior que zero.',
        month: 'Mês',
        year: 'Ano'
      },
      'en-US': {
        title: 'Retirement and Investment Simulator',
        subtitle: 'Adjust the values below and see how time, monthly contributions and compound interest can impact your future wealth.',
        formBadge: 'Input data',
        formSubtitle: 'Fill in your investment plan information. Annual rates should be entered as',
        formSubtitleBold: 'percentage per year',
        formSubtitleEnd: '(e.g., 16.5 for 16.5% p.a.).',
        prazoLabel: 'Investment horizon (years)',
        prazoHelp: 'How long you plan to keep the money invested.',
        prazoSuffix: 'years',
        valorInicialLabel: 'Initial amount',
        valorInicialHelp: 'Capital already invested today.',
        valorInicialSuffix: '$',
        aporteMensalLabel: 'Monthly contribution',
        aporteMensalHelp: 'How much you plan to invest every month.',
        aporteMensalSuffix: '$ / month',
        taxaAnualLabel: 'Annual return',
        taxaAnualHelp: 'Estimated average investment rate (gross, per year).',
        taxaSuffix: '% p.a.',
        correcaoLabel: 'Annual contribution increase',
        correcaoHelp: 'Yearly percentage increase of the monthly contribution (e.g., to account for inflation or income growth).',
        inflacaoLabel: 'Estimated average annual inflation',
        inflacaoHelp: '10-year historical average: Brazil ~6.5%, USA ~3.5%. Used to calculate future purchasing power.',
        runSim: 'Run simulation',
        resultsBadge: 'Results',
        resultsSubtitle: 'Values below are estimates, assuming constant monthly contributions over the period, with annual adjustment and monthly compound interest.',
        totalInvestido: 'Total invested',
        patrimonioFinal: 'Final wealth',
        rendaMensal: 'Estimated monthly income',
        rendaMensalAjustada: 'Adjusted income (today)',
        ultimoAporte: 'Last monthly contribution',
        totalInvestidoNote: 'Sum of all contributions made, including the initial amount.',
        patrimonioFinalNote: 'Estimated value at the end of the period, considering compound interest.',
        rendaMensalNote: 'Approximate monthly income using the same monthly investment rate.',
        rendaMensalAjustadaNote: 'Equivalent purchasing power of monthly income in today\'s values, considering inflation.',
        ultimoAporteNote: 'Approximate monthly contribution value in the last year of the simulation.',
        hints: ['If there is no initial amount, leave the field at 0.', 'If you do not want monthly contributions, leave the field at 0.', 'Rates used are examples only. Adjust according to the investment type and your risk profile.'],
        disclaimer: 'This simulator is an educational tool and does not constitute investment advice. Consider costs, taxes and your profile before making real financial decisions.',
        footer: 'Tip: you can freely adjust rates and amounts to test different retirement or long-term wealth-building scenarios.',
        chartBadge: 'Wealth evolution',
        chartSubtitle: 'Blue line shows total wealth, green shows total invested, and orange shows inflation-adjusted wealth (real purchasing power).',
        chartTotal: 'Total Wealth',
        chartInvested: 'Total Invested',
        chartInflationAdj: 'Inflation-Adjusted',
        errorPrazo: 'Investment horizon must be greater than zero.',
        month: 'Month',
        year: 'Year'
      }
    };

    function parsePercentInput(value) {
      const num = parseFloat(value.toString().replace(",", "."));
      if (isNaN(num) || num < 0) return 0;
      // Entrada em %, convertemos para fração (ex.: 16.5 -> 0.165)
      return num / 100;
    }

    function parseNumberInput(value) {
      const num = parseFloat(value.toString().replace(",", "."));
      if (isNaN(num) || num < 0) return 0;
      return num;
    }

    function formatCurrency(value) {
      const locale = currentLang;
      const currency = currentCurrency;
      return new Intl.NumberFormat(locale, {
        style: 'currency',
        currency,
        maximumFractionDigits: 2
      }).format(value || 0);
    }

    function updateChart(labels, patrimonioData, investidoData, inflationAdjData) {
      const ctx = document.getElementById('chartPatrimonio').getContext('2d');

      if (chartInstance) {
        chartInstance.destroy();
      }

      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: i18n[currentLang].chartTotal,
              data: patrimonioData,
              borderColor: '#1a73e8',
              backgroundColor: 'rgba(26, 115, 232, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 6
            },
            {
              label: i18n[currentLang].chartInvested,
              data: investidoData,
              borderColor: '#34a853',
              backgroundColor: 'rgba(52, 168, 83, 0.05)',
              borderWidth: 2,
              fill: false,
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 6,
              borderDash: [5, 5]
            },
            {
              label: i18n[currentLang].chartInflationAdj,
              data: inflationAdjData,
              borderColor: '#f9ab00',
              backgroundColor: 'rgba(249, 171, 0, 0.05)',
              borderWidth: 2,
              fill: false,
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 6,
              borderDash: [3, 3]
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                usePointStyle: true,
                padding: 15,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              titleFont: {
                size: 13
              },
              bodyFont: {
                size: 12
              },
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += formatCurrency(context.parsed.y);
                  return label;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
                maxRotation: 45,
                minRotation: 45,
                autoSkip: true,
                maxTicksLimit: 12
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  // Abreviação em milhares, sem símbolo (tooltip mostra com símbolo)
                  return (value / 1000).toFixed(0) + 'k';
                }
              }
            }
          }
        }
      });
    }

    function simulate() {
      const errorEl = document.getElementById("error");
      errorEl.style.display = "none";
      errorEl.textContent = "";

      const prazoAnos = parseNumberInput(document.getElementById("prazo").value);
      const valorInicial = parseNumberInput(document.getElementById("valorInicial").value);
      const aporteMensalBase = parseNumberInput(document.getElementById("aporteMensal").value);
      const taxaAnual = parsePercentInput(document.getElementById("taxaAnual").value);
      const correcaoAporteAnual = parsePercentInput(document.getElementById("correcaoAporte").value);
      const inflacaoAnual = parsePercentInput(document.getElementById("inflacao").value);

      if (prazoAnos <= 0) {
        errorEl.style.display = "block";
        errorEl.textContent = i18n[currentLang].errorPrazo;
        return;
      }

      const meses = Math.round(prazoAnos * 12);

      // Taxa de juros mensal equivalente
      const taxaMensal = Math.pow(1 + taxaAnual, 1 / 12) - 1;
      // Correção mensal aproximada do aporte
      const correcaoMensal = Math.pow(1 + correcaoAporteAnual, 1 / 12) - 1;
      // Inflação mensal
      const inflacaoMensal = Math.pow(1 + inflacaoAnual, 1 / 12) - 1;

      let patrimonio = valorInicial;
      let totalInvestido = valorInicial;
      let aporteAtual = aporteMensalBase;
      let ultimoAporte = aporteMensalBase;

      // Arrays para o gráfico
      const labels = [];
      const patrimonioData = [];
      const investidoData = [];
      const inflationAdjData = [];

      // Adiciona ponto inicial
      const t = i18n[currentLang];
      labels.push(`${t.month} 0`);
      patrimonioData.push(valorInicial);
      investidoData.push(valorInicial);
      inflationAdjData.push(valorInicial);

      // Frequência de amostragem para o gráfico (captura a cada N meses)
      const sampleRate = Math.max(1, Math.floor(meses / 60)); // Máximo de 60 pontos no gráfico

      for (let m = 1; m <= meses; m++) {
        // aplica juros sobre o patrimônio existente
        patrimonio = patrimonio * (1 + taxaMensal);
        // adiciona aporte do mês
        patrimonio += aporteAtual;
        totalInvestido += aporteAtual;

        // guarda o último aporte (será o do mês final)
        ultimoAporte = aporteAtual;

        // Adiciona ao gráfico (com amostragem ou no último mês)
        if (m % sampleRate === 0 || m === meses) {
          const ano = Math.floor(m / 12);
          const mes = m % 12;
          const t = i18n[currentLang];
          labels.push(ano > 0 ? `${t.year} ${ano}${mes > 0 ? `.${mes}` : ''}` : `${t.month} ${m}`);
          patrimonioData.push(Math.round(patrimonio));
          investidoData.push(Math.round(totalInvestido));
          // Patrimônio ajustado pela inflação (traz para valores de hoje)
          const patrimonioAjustado = patrimonio / Math.pow(1 + inflacaoAnual, m / 12);
          inflationAdjData.push(Math.round(patrimonioAjustado));
        }

        // atualiza aporte para o próximo mês
        aporteAtual = aporteAtual * (1 + correcaoMensal);
      }

      const rendaMensal = patrimonio * taxaMensal;
      // Renda ajustada pela inflação (poder de compra em valores de hoje)
      const rendaAjustada = rendaMensal / Math.pow(1 + inflacaoAnual, prazoAnos);

      document.getElementById("outTotalInvestido").textContent = formatCurrency(totalInvestido);
      document.getElementById("outPatrimonioFinal").textContent = formatCurrency(patrimonio);
      document.getElementById("outRendaMensal").textContent = formatCurrency(rendaMensal);
      document.getElementById("outRendaAjustada").textContent = formatCurrency(rendaAjustada);
      document.getElementById("outUltimoAporte").textContent = formatCurrency(ultimoAporte);

      // Atualiza o gráfico
      updateChart(labels, patrimonioData, investidoData, inflationAdjData);
    }

    document.getElementById("btnSimular").addEventListener("click", simulate);

    function applyTexts() {
      const t = i18n[currentLang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('subtitle').textContent = t.subtitle;
      // Badges, labels and notes
      document.querySelector('.grid .card .card-title .card-title-badge').textContent = t.formBadge;
      document.querySelectorAll('label[for="prazo"]')[0].childNodes[2].nodeValue = ' ' + t.prazoLabel + '\n';
      document.querySelector('label[for="prazo"] small').textContent = t.prazoHelp;
      document.querySelectorAll('label[for="valorInicial"]')[0].childNodes[2].nodeValue = ' ' + t.valorInicialLabel + '\n';
      document.querySelector('label[for="valorInicial"] small').textContent = t.valorInicialHelp;
      document.querySelectorAll('label[for="aporteMensal"]')[0].childNodes[2].nodeValue = ' ' + t.aporteMensalLabel + '\n';
      document.querySelector('label[for="aporteMensal"] small').textContent = t.aporteMensalHelp;
      document.querySelectorAll('label[for="taxaAnual"]')[0].childNodes[2].nodeValue = ' ' + t.taxaAnualLabel + '\n';
      document.querySelector('label[for="taxaAnual"] small').textContent = t.taxaAnualHelp;
      document.querySelectorAll('label[for="correcaoAporte"]')[0].childNodes[2].nodeValue = ' ' + t.correcaoLabel + '\n';
      document.querySelector('label[for="correcaoAporte"] small').textContent = t.correcaoHelp;
      document.getElementById('labelInflacao').textContent = t.inflacaoLabel;
      document.getElementById('helpInflacao').textContent = t.inflacaoHelp;
      document.getElementById('btnSimular').innerHTML = '<span class="btn-icon">▶</span>' + t.runSim;

      // Form subtitle
      const formSub = document.getElementById('formSubtitle');
      formSub.innerHTML = t.formSubtitle + ' <strong>' + t.formSubtitleBold + '</strong> ' + t.formSubtitleEnd;

      // Suffixes
      document.getElementById('suffixPrazo').textContent = t.prazoSuffix;
      document.getElementById('suffixValor').textContent = currentCurrency === 'BRL' ? t.valorInicialSuffix : '$';
      document.getElementById('suffixAporte').textContent = t.aporteMensalSuffix;
      document.getElementById('suffixTaxa').textContent = t.taxaSuffix;
      document.getElementById('suffixCorrecao').textContent = t.taxaSuffix;
      document.getElementById('suffixInflacao').textContent = t.taxaSuffix;

      // Resultados
      const resultCards = document.querySelectorAll('.results-grid .result-card');
      resultCards[0].querySelector('.result-label').textContent = t.totalInvestido;
      resultCards[0].querySelector('.result-note').textContent = t.totalInvestidoNote;
      resultCards[1].querySelector('.result-label').textContent = t.patrimonioFinal;
      resultCards[1].querySelector('.result-note').textContent = t.patrimonioFinalNote;
      resultCards[2].querySelector('.result-label').textContent = t.rendaMensal;
      resultCards[2].querySelector('.result-note').textContent = t.rendaMensalNote;
      resultCards[3].querySelector('.result-label').textContent = t.rendaMensalAjustada;
      resultCards[3].querySelector('.result-note').textContent = t.rendaMensalAjustadaNote;
      resultCards[4].querySelector('.result-label').textContent = t.ultimoAporte;
      resultCards[4].querySelector('.result-note').textContent = t.ultimoAporteNote;

      // Badge e subtítulo de resultados
      document.querySelectorAll('.grid .card .card-title .card-title-badge')[1].textContent = t.resultsBadge;
      document.querySelectorAll('.grid .card .card-subtitle')[1].textContent = t.resultsSubtitle;

      // Gráfico
      document.querySelector('.chart-container .card-title .card-title-badge').textContent = t.chartBadge;
      document.querySelector('.chart-container .card-subtitle').textContent = t.chartSubtitle;

      // Hints
      const ul = document.querySelector('.info-list');
      ul.innerHTML = '';
      t.hints.forEach(h => {
        const li = document.createElement('li');
        li.textContent = h;
        ul.appendChild(li);
      });

      // Disclaimer e footer
      document.querySelector('.disclaimer').textContent = t.disclaimer;
      document.querySelector('footer').textContent = t.footer;
    }

    document.getElementById('lang').addEventListener('change', (e) => {
      currentLang = e.target.value;
      applyTexts();
      simulate();
    });

    document.getElementById('currency').addEventListener('change', (e) => {
      currentCurrency = e.target.value;
      simulate();
    });

    // Inicializa textos e simulação
    applyTexts();
    simulate();
  </script>
</body>
</html>
